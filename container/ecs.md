# ECS

cf. [今さら聞けないAWS ECSとは？Fargateとは？](https://qiita.com/K5K/items/0d8dbdb39fbb0375e2bd)

Amazon ECS（Elastic Container Service）は、**コンテナ化されたアプリケーションをAWS上で簡単に実行・スケーリング・管理できるサービス**です。以下は、ECSの全体概要と主要な構成要素（クラスタ、サービス、タスク、タスク定義）の解説です。

![ecs](/resources/img/ecs.avif)

## 全体概要

ECSは、Dockerコンテナを実行・管理するための**マネージド型コンテナオーケストレーションサービス**です。ユーザーはインフラの管理を気にせず、タスク定義に基づいてアプリケーションを自動的に配置・実行・スケールできます。

ECSは以下2つの実行環境（**ランタイム**）を選択できます：

* **Fargate**: サーバーレスでインフラ管理不要。ECSが自動でリソースを確保。
* **EC2**: 自前で用意したEC2インスタンス上でタスクを実行。

## 構成要素

### 1. クラスタ（Cluster）

* ECSの**リソースの論理的なグループ**です。
* 1つのクラスタには複数のサービスやタスクを含めることができます。
* 実行タイプ（Fargate/EC2）に応じて、クラスタの中にFargateタスクやEC2インスタンスを配置します。

### 2. タスク定義（Task Definition）

* ECSにおける**Docker Composeのような役割**。
* 実行するコンテナの設定（イメージ、ポート、CPU、メモリ、環境変数、ボリュームなど）を定義したテンプレート。
* バージョン管理されており、更新ごとにリビジョンが作成されます。

例：

```json
{
  "containerDefinitions": [
    {
      "name": "web",
      "image": "nginx:latest",
      "cpu": 256,
      "memory": 512,
      "portMappings": [{ "containerPort": 80 }]
    }
  ]
}
```

### 3. タスク（Task）

* **タスク定義を基に実行される具体的なインスタンス（実体）**。
* 単発のバッチ処理や1回限りの処理に使うことも可能。

### 4. サービス（Service）

* タスクを**指定した数だけ常に実行し続けるための管理レイヤー**。
* タスクが落ちたら自動で再起動・再配置される。
* Auto Scaling や ELB（ロードバランサ）との連携も可能。

## まとめ表

| 項目              | 役割                     |
| --------------- | ---------------------- |
| Cluster         | ECSリソースのグループ           |
| Task            | タスク定義から生成されたコンテナ群の実体   |
| Task Definition | 実行するコンテナの設定テンプレート      |
| Service         | タスクの常時稼働を維持・スケール制御する機能 |
